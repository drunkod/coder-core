name: Export Docker container

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Build and export Docker container
        run: |
          # Check if the arguments are valid
          if [ $# -ne 2 ]; then
            echo "Usage: $0 image_name output_file"
            exit 1
          fi

          # Assign the arguments to variables
          image_name=$1
          output_file=$2

          # Create a temporary container from the image
          container_id=$(docker create $image_name)

          # Export the container's filesystem to a tar file
          docker export $container_id > $output_file.tar

          # Remove the temporary container
          docker rm $container_id

          # Compress the tar file into gzip format
          gzip -f $output_file.tar

          # Print a success message
          echo "The rootfs of $image_name has been extracted to ${output_file}.tar.gz"
          
        env:
          # Set environment variables for your script
          IMAGE_NAME: your_image_name
          OUTPUT_FILE: your_output_file
